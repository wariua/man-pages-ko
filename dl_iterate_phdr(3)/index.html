<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="리눅스 매뉴얼 페이지 일부 한글 번역">
    
    <link rel="canonical" href="https://wariua.github.io/man-pages-ko/dl_iterate_phdr%283%29/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>dl_iterate_phdr(3) - man-pages-ko</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/idea.min.css">
        
    
    <link href="../css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="..">man-pages-ko</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../section_file/">File</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_ipc/">IPC</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_memory/">Memory</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_network/">Network</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_process/">Process</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_thread/">Thread</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_trouble_shooting/">Trouble Shooting</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_others/">Others</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#name">NAME</a></li>
        <li class="first-level "><a href="#synopsis">SYNOPSIS</a></li>
        <li class="first-level "><a href="#description">DESCRIPTION</a></li>
        <li class="first-level "><a href="#return-value">RETURN VALUE</a></li>
        <li class="first-level "><a href="#versions">VERSIONS</a></li>
        <li class="first-level "><a href="#attributes">ATTRIBUTES</a></li>
        <li class="first-level "><a href="#conforming-to">CONFORMING TO</a></li>
        <li class="first-level "><a href="#notes">NOTES</a></li>
        <li class="first-level "><a href="#examples">EXAMPLES</a></li>
            <li class="second-level"><a href="#_1">프로그램 소스</a></li>
                
        <li class="first-level "><a href="#see-also">SEE ALSO</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="name">NAME</h2>
<p>dl_iterate_phdr - 공유 오브젝트 리스트 순회하기</p>
<h2 id="synopsis">SYNOPSIS</h2>
<pre><code class="language-c">#define _GNU_SOURCE         /* feature_test_macros(7) 참고 */
#include &lt;link.h&gt;

int dl_iterate_phdr(
          int (*callback)(struct dl_phdr_info *info,
                          size_t size, void *data),
          void *data);
</code></pre>
<h2 id="description">DESCRIPTION</h2>
<p><code>dl_iterate_phdr()</code> 함수를 이용해 응용에서 어떤 공유 오브젝트들을 적재했고 어떤 순서로 적재됐는지 런타임에 질의할 수 있다.</p>
<p><code>dl_iterate_phdr()</code> 함수는 응용의 공유 오브젝트 목록을 순회하면서 각 오브젝트마다 함수 <code>callback</code>을 호출한다. 모든 공유 오브젝트를 처리했으면, 또는 <code>callback</code>이 0 아닌 값을 반환하면 멈춘다.</p>
<p><code>callback</code> 호출 각각은 세 개 인자를 받는다. <code>info</code>는 공유 오브젝트에 대한 정보를 담은 구조체의 포인터이고 <code>size</code>는 <code>info</code>가 가리키는 구조체의 크기이다. <code>data</code>는 호출 프로그램에서 <code>dl_iterate_phdr()</code> 호출 때 (역시 이름이 <code>data</code>인) 두 번째 인자로 준 값의 사본이다.</p>
<p><code>info</code> 인자는 다음 타입의 구조체이다.</p>
<pre><code class="language-c">struct dl_phdr_info {
    ElfW(Addr)        dlpi_addr;  /* 오브젝트의 기준 주소 */
    const char       *dlpi_name;  /* 오브젝트의 (널 종료) 이름 */
    const ElfW(Phdr) *dlpi_phdr;  /* 이 오브젝트의 ELF 프로그램
                                     헤더 배열의 포인터 */
    ElfW(Half)        dlpi_phnum; /* dlpi_phdr의 항목 개수 */

    /* 다음 필드들은 이 구조체의 첫 번째 버전이 공개된 후에
       glibc 2.4에서 추가된 것들이다. dl_iterate_phdr 콜백에
       전달되는 size 인자를 사용해서 이후 멤버 각각이 사용
       가능한지 여부를 확인해야 한다. */

    unsigned long long dlpi_adds;
                    /* 새 오브젝트가 추가됐을 수도
               있을 때 증가됨 */
    unsigned long long dlpi_subs;
                    /* 오브젝트가 제거됐을 수도
               있을 때 증가됨 */
    size_t dlpi_tls_modid;
                    /* PT_TLS 세그먼트가 있는 경우는 TLS 재배치에
               쓰인 그 모듈 ID, 아니면 0 */
    void  *dlpi_tls_data;
                    /* 이 모듈의 PT_TLS 세그먼트 인스턴스가
               하나 있고 호출 스레드에 할당돼 있으면
               그 주소, 아니면 널 포인터 */
};
</code></pre>
<p>(<code>ElfW()</code> 매크로는 그 인자를 하드웨어 아키텍처에 맞는 ELF 데이터 타입 이름으로 바꿔 준다. 예를 들어 32비트 플랫폼에서 <code>ElfW(Addr)</code>은 데이터 타입 이름 <code>Elf32_Addr</code>을 내놓는다. 이런 타입들에 대한 추가 정보를 헤더 파일 <code>&lt;elf.h&gt;</code> 및 <code>&lt;link.h&gt;</code>에서 볼 수 있다.)</p>
<p><code>dlpi_addr</code> 필드는 공유 오브젝트의 기준 주소를 나타낸다. (즉 공유 오브젝트의 가상 메모리 주소와 그 오브젝트를 적재한 파일 내에서의 오프셋 간의 차이이다.) <code>dlpi_name</code> 필드는 그 공유 오브젝트를 적재한 경로명을 알려 주는 널 종료 문자열이다.</p>
<p><code>dlpi_phdr</code> 및 <code>dlpi_phnum</code> 필드의 의미를 이해하려면 ELF 공유 오브젝트가 여러 세그먼트로 이뤄져 있고 각각에 그 세그먼트를 기술하는 프로그램 헤더가 있다는 점을 알아야 한다. <code>dlpi_phdr</code> 필드는 이 공유 오브젝트의 프로그램 헤더들의 배열에 대한 포인터이다. <code>dlpi_phnum</code> 필드는 그 배열의 크기를 나타낸다.</p>
<p>그 프로그램 헤더들은 다음 형태의 구조체이다.</p>
<pre><code class="language-c">typedef struct {
    Elf32_Word  p_type;    /* 세그먼트 타입 */
    Elf32_Off   p_offset;  /* 세그먼트 파일 오프셋 */
    Elf32_Addr  p_vaddr;   /* 세그먼트 가상 주소 */
    Elf32_Addr  p_paddr;   /* 세그먼트 물리 주소 */
    Elf32_Word  p_filesz;  /* 파일 내 세그먼트 크기 */
    Elf32_Word  p_memsz;   /* 메모리 내 세그먼트 크기 */
    Elf32_Word  p_flags;   /* 세그먼트 플래그 */
    Elf32_Word  p_align;   /* 세그먼트 정렬 */
} Elf32_Phdr;
</code></pre>
<p>참고로 다음 식을 사용해 특정 프로그램 헤더 <code>x</code>의 가상 메모리 내 위치를 계산할 수 있다.</p>
<pre><code class="language-c">addr == info-&gt;dlpi_addr + info-&gt;dlpi_phdr[x].p_vaddr;
</code></pre>
<p><code>p_type</code>에 가능한 값들로 다음이 있다. (더 자세한 내용은 <code>&lt;elf.h&gt;</code> 참고.)</p>
<pre><code class="language-c">#define PT_LOAD         1    /* 적재 가능 프로그램 세그먼트 */
#define PT_DYNAMIC      2    /* 동적 링크 정보 */
#define PT_INTERP       3    /* 프로그램 인터프리터 */
#define PT_NOTE         4    /* 보조 정보 */
#define PT_SHLIB        5    /* 예비 */
#define PT_PHDR         6    /* 헤더 테이블 자체를 위한 항목 */
#define PT_TLS          7    /* 스레드 로컬 저장 공간 세그먼트 */
#define PT_GNU_EH_FRAME 0x6474e550 /* GCC .eh_frame_hdr segment */
#define PT_GNU_STACK  0x6474e551 /* 스택 실행 가능 여부 표시 */
#define PT_GNU_RELRO  0x6474e552 /* 재배치 후에는 읽기 전용 */
</code></pre>
<h2 id="return-value">RETURN VALUE</h2>
<p><code>dl_iterate_phdr()</code> 함수는 마지막 <code>callback</code> 호출이 반환한 값을 그대로 반환한다.</p>
<h2 id="versions">VERSIONS</h2>
<p>glibc 버전 2.2.4부터 <code>dl_iterate_phdr()</code>를 지원한다.</p>
<h2 id="attributes">ATTRIBUTES</h2>
<p>이 절에서 사용하는 용어들에 대한 설명은 <tt><a class="wikilink" href="/man-pages-ko/attributes(7)/">attributes(7)</a></tt>를 보라.</p>
<table>
<thead>
<tr>
<th>인터페이스</th>
<th>속성</th>
<th>값</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dl_iterate_phdr()</code></td>
<td>스레드 안전성</td>
<td>MT-Safe</td>
</tr>
</tbody>
</table>
<h2 id="conforming-to">CONFORMING TO</h2>
<p><code>dl_iterate_phdr()</code> 함수는 어느 표준에도 명세돼 있지 않다. 다른 여러 시스템에서도 이 함수를 제공하지만 반환되는 <code>dl_phdr_info</code> 구조체의 세부 내용이 다르다. BSD와 솔라리스에서는 구조체에 <code>dlpi_addr</code>, <code>dlpi_name</code>, <code>dlpi_phdr</code>, <code>dlpi_phnum</code> 필드에 더해서 다른 구현별 필드들이 포함돼 있다.</p>
<h2 id="notes">NOTES</h2>
<p>C 라이브러리의 이후 버전에서 <code>dl_phdr_info</code> 구조체에 필드를 더 추가할 수도 있다. 그 경우 콜백 함수에서는 <code>size</code> 인자를 통해 추가 필드가 있는 시스템에서 동작 중인지 알아낼 수 있다.</p>
<p><code>callback</code>이 방문하는 첫 번째 오브젝트는 메인 프로그램이다. 메인 프로그램에서 <code>dlpi_name</code> 필드는 빈 문자열이 된다.</p>
<h2 id="examples">EXAMPLES</h2>
<p>다음 프로그램에서는 적재한 공유 오브젝트들의 경로명 목록을 표시한다. 그리고 각 공유 오브젝트에 대해서 오브젝트의 각 ELF 세그먼트의 정보(가상 주소, 크기, 플래그, 타입)를 나열한다.</p>
<p>다음 셸 세션은 x86-64 시스템에서 프로그램이 내놓는 출력을 보여 준다. 출력 첫 번째의 (이름이 빈 문자열인) 공유 오브젝트는 메인 프로그램이다.</p>
<pre><code class="language-text">$ ./a.out
Name: &quot;&quot; (9 segments)
     0: [      0x400040; memsz:    1f8] flags: 0x5; PT_PHDR
     1: [      0x400238; memsz:     1c] flags: 0x4; PT_INTERP
     2: [      0x400000; memsz:    ac4] flags: 0x5; PT_LOAD
     3: [      0x600e10; memsz:    240] flags: 0x6; PT_LOAD
     4: [      0x600e28; memsz:    1d0] flags: 0x6; PT_DYNAMIC
     5: [      0x400254; memsz:     44] flags: 0x4; PT_NOTE
     6: [      0x400970; memsz:     3c] flags: 0x4; PT_GNU_EH_FRAME
     7: [         (nil); memsz:      0] flags: 0x6; PT_GNU_STACK
     8: [      0x600e10; memsz:    1f0] flags: 0x4; PT_GNU_RELRO
Name: &quot;linux-vdso.so.1&quot; (4 segments)
     0: [0x7ffc6edd1000; memsz:    e89] flags: 0x5; PT_LOAD
     1: [0x7ffc6edd1360; memsz:    110] flags: 0x4; PT_DYNAMIC
     2: [0x7ffc6edd17b0; memsz:     3c] flags: 0x4; PT_NOTE
     3: [0x7ffc6edd17ec; memsz:     3c] flags: 0x4; PT_GNU_EH_FRAME
Name: &quot;/lib64/libc.so.6&quot; (10 segments)
     0: [0x7f55712ce040; memsz:    230] flags: 0x5; PT_PHDR
     1: [0x7f557145b980; memsz:     1c] flags: 0x4; PT_INTERP
     2: [0x7f55712ce000; memsz: 1b6a5c] flags: 0x5; PT_LOAD
     3: [0x7f55716857a0; memsz:   9240] flags: 0x6; PT_LOAD
     4: [0x7f5571688b80; memsz:    1f0] flags: 0x6; PT_DYNAMIC
     5: [0x7f55712ce270; memsz:     44] flags: 0x4; PT_NOTE
     6: [0x7f55716857a0; memsz:     78] flags: 0x4; PT_TLS
     7: [0x7f557145b99c; memsz:   544c] flags: 0x4; PT_GNU_EH_FRAME
     8: [0x7f55712ce000; memsz:      0] flags: 0x6; PT_GNU_STACK
     9: [0x7f55716857a0; memsz:   3860] flags: 0x4; PT_GNU_RELRO
Name: &quot;/lib64/ld-linux-x86-64.so.2&quot; (7 segments)
     0: [0x7f557168f000; memsz:  20828] flags: 0x5; PT_LOAD
     1: [0x7f55718afba0; memsz:   15a8] flags: 0x6; PT_LOAD
     2: [0x7f55718afe10; memsz:    190] flags: 0x6; PT_DYNAMIC
     3: [0x7f557168f1c8; memsz:     24] flags: 0x4; PT_NOTE
     4: [0x7f55716acec4; memsz:    604] flags: 0x4; PT_GNU_EH_FRAME
     5: [0x7f557168f000; memsz:      0] flags: 0x6; PT_GNU_STACK
     6: [0x7f55718afba0; memsz:    460] flags: 0x4; PT_GNU_RELRO
</code></pre>
<h3 id="_1">프로그램 소스</h3>
<pre><code class="language-c">#define _GNU_SOURCE
#include &lt;link.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;

static int
callback(struct dl_phdr_info *info, size_t size, void *data)
{
    char *type;
    int p_type;

    printf(&quot;Name: \&quot;%s\&quot; (%d segments)\n&quot;, info-&gt;dlpi_name,
               info-&gt;dlpi_phnum);

    for (int j = 0; j &lt; info-&gt;dlpi_phnum; j++) {
        p_type = info-&gt;dlpi_phdr[j].p_type;
        type =  (p_type == PT_LOAD) ? &quot;PT_LOAD&quot; :
                (p_type == PT_DYNAMIC) ? &quot;PT_DYNAMIC&quot; :
                (p_type == PT_INTERP) ? &quot;PT_INTERP&quot; :
                (p_type == PT_NOTE) ? &quot;PT_NOTE&quot; :
                (p_type == PT_INTERP) ? &quot;PT_INTERP&quot; :
                (p_type == PT_PHDR) ? &quot;PT_PHDR&quot; :
                (p_type == PT_TLS) ? &quot;PT_TLS&quot; :
                (p_type == PT_GNU_EH_FRAME) ? &quot;PT_GNU_EH_FRAME&quot; :
                (p_type == PT_GNU_STACK) ? &quot;PT_GNU_STACK&quot; :
                (p_type == PT_GNU_RELRO) ? &quot;PT_GNU_RELRO&quot; : NULL;

        printf(&quot;    %2d: [%14p; memsz:%7jx] flags: %#jx; &quot;, j,
                (void *) (info-&gt;dlpi_addr + info-&gt;dlpi_phdr[j].p_vaddr),
                (uintmax_t) info-&gt;dlpi_phdr[j].p_memsz,
                (uintmax_t) info-&gt;dlpi_phdr[j].p_flags);
        if (type != NULL)
            printf(&quot;%s\n&quot;, type);
        else
            printf(&quot;[other (%#x)]\n&quot;, p_type);
    }

    return 0;
}

int
main(int argc, char *argv[])
{
    dl_iterate_phdr(callback, NULL);

    exit(EXIT_SUCCESS);
}
</code></pre>
<h2 id="see-also">SEE ALSO</h2>
<p><code>ldd(1)</code>, <tt><a class="wikilink" href="/man-pages-ko/objdump(1)/">objdump(1)</a></tt>, <tt><a class="wikilink" href="/man-pages-ko/readelf(1)/">readelf(1)</a></tt>, <tt><a class="wikilink" href="/man-pages-ko/dladdr(3)/">dladdr(3)</a></tt>, <tt><a class="wikilink" href="/man-pages-ko/dlopen(3)/">dlopen(3)</a></tt>, <tt><a class="wikilink" href="/man-pages-ko/elf(5)/">elf(5)</a></tt>, <tt><a class="wikilink" href="/man-pages-ko/ld.so(8)/">ld.so(8)</a></tt></p>
<p><em>Executable and Linking Format Specification</em>, 온라인 여러 곳에서 구할 수 있음.</p>
<hr />
<p>2021-03-22</p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
