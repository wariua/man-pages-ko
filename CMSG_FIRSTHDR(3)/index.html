<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="리눅스 매뉴얼 페이지 일부 한글 번역">
    
    <link rel="canonical" href="https://wariua.github.io/man-pages-ko/CMSG_FIRSTHDR%283%29/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>CMSG_FIRSTHDR(3) - man-pages-ko</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/idea.min.css">
        
    
    <link href="../css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="..">man-pages-ko</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../section_file/">File</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_ipc/">IPC</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_memory/">Memory</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_network/">Network</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_process/">Process</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_thread/">Thread</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_trouble_shooting/">Trouble Shooting</a>
                    </li>
                
                
                
                    <li >
                        <a href="../section_others/">Others</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#name">NAME</a></li>
        <li class="first-level "><a href="#synopsis">SYNOPSIS</a></li>
        <li class="first-level "><a href="#description">DESCRIPTION</a></li>
        <li class="first-level "><a href="#conforming-to">CONFORMING TO</a></li>
        <li class="first-level "><a href="#notes">NOTES</a></li>
        <li class="first-level "><a href="#examples">EXAMPLES</a></li>
        <li class="first-level "><a href="#see-also">SEE ALSO</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="name">NAME</h2>
<p>CMSG_ALIGN, CMSG_SPACE, CMSG_NXTHDR, CMSG_FIRSTHDR - 보조 데이터에 접근하기</p>
<h2 id="synopsis">SYNOPSIS</h2>
<pre><code class="language-c">#include &lt;sys/socket.h&gt;

struct cmsghdr *CMSG_FIRSTHDR(struct msghdr *msgh);
struct cmsghdr *CMSG_NXTHDR(struct msghdr *msgh,
                            struct cmsghdr *cmsg);
size_t CMSG_ALIGN(size_t length);
size_t CMSG_SPACE(size_t length);
size_t CMSG_LEN(size_t length);
unsigned char *CMSG_DATA(struct cmsghdr *cmsg);
</code></pre>
<h2 id="description">DESCRIPTION</h2>
<p>이 매크로들을 이용해 소켓 페이로드에 포함되지 않는 제어 메시지(보조 데이터라고도 함)를 생성하고 접근한다. 그런 제어 정보로는 패킷을 받은 인터페이스, 드물게 쓰이는 여러 헤더 필드들, 상세한 오류 설명, 파일 디스크립터, 유닉스 크리덴셜 집합 등이 있을 수 있다. 예를 들어 제어 메시지를 사용해 IP 옵션 같은 추가 헤더 필드를 보낼 수 있다. <tt><a class="wikilink" href="/man-pages-ko/sendmsg(2)/">sendmsg(2)</a></tt>를 호출해서 보조 데이터를 보내고 <tt><a class="wikilink" href="/man-pages-ko/recvmsg(2)/">recvmsg(2)</a></tt>를 호출해서 받는다. 자세한 내용은 각 매뉴얼 페이지를 보라.</p>
<p>보조 데이터는 <code>cmsghdr</code> 구조체에 데이터를 덧붙인 것의 배열이다. 사용할 수 있는 제어 메시지 종류에 대해선 프로토콜별 맨 페이지를 보라. 소켓별 보조 버퍼 최대 크기를 <code>/proc/sys/net/core/optmem_max</code>로 설정할 수 있다. <tt><a class="wikilink" href="/man-pages-ko/socket(7)/">socket(7)</a></tt> 참고.</p>
<p><code>cmsghdr</code> 구조체는 다음처럼 정의돼 있다.</p>
<pre><code class="language-c">struct cmsghdr {
    size_t cmsg_len;    /* 데이터 바이트 수. 헤더 포함.
                           (POSIX에서는 타입이 socklen_t) */
    int    cmsg_level;  /* 기원 프로토콜 */
    int    cmsg_type;   /* 프로토콜별 종류 */
/* 이어서:
    unsigned char cmsg_data[]; */
};
</code></pre>
<p><code>cmsghdr</code> 구조체 열에 절대 직접 접근하지 말아야 한다. 대신 다음 매크로들을 쓰면 된다.</p>
<ul>
<li>
<p><code>CMSG_FIRSTHDR()</code>는 받은 <code>msghdr</code>에 연계된 보조 데이터 버퍼의 첫 번째 <code>cmsghdr</code>에 대한 포인터를 반환한다. 버퍼에 <code>cmsghdr</code>가 들어갈 공간이 없으면 NULL을 반환한다.</p>
</li>
<li>
<p><code>CMSG_NXTHDR()</code>는 받은 <code>cmsghdr</code> 다음의 유효한 <code>cmsghdr</code>를 반환한다. 버퍼에 충분한 공간이 남아 있지 않으면 NULL을 반환한다.</p>
</li>
</ul>
<p>(가령 <tt><a class="wikilink" href="/man-pages-ko/sendmsg(2)/">sendmsg(2)</a></tt>로 보낼) 일련의 <code>cmsghdr</code> 구조체를 담을 버퍼를 초기화할 때는 <code>CMSG_NXTHDR()</code>의 올바른 동작을 위해 먼저 버퍼를 0으로 채우는 게 좋다.</p>
<ul>
<li>
<p><code>CMSG_ALIGN()</code>은 길이를 받아서 필수 정렬을 포함한 길이를 반환한다. 상수 식이다.</p>
</li>
<li>
<p><code>CMSG_SPACE()</code>는 받은 데이터 길이의 페이로드를 가진 보조 항목이 차지하는 바이트 수를 반환한다. 상수 식이다.</p>
</li>
<li>
<p><code>CMSG_DATA()</code>는 <code>cmsghdr</code>의 데이터 부분에 대한 포인터를 반환한다. 반환되는 포인터가 어떤 페이로드 데이터 타입이든 접근하기 적합하도록 정렬돼 있다고 상정할 수 없다. 응용에서 이를 페이로드에 맞는 포인터 타입으로 캐스팅하지 말아야 한다. 그보단 적절한 객체를 선언해서 <code>memcpy(3)</code>로 데이터를 복사하는 게 좋다.</p>
</li>
<li>
<p><code>CMSG_LEN()</code>은 <code>cmsghdr</code> 구조체의 <code>cmsg_len</code> 멤버에 저장할 값을 반환하는데, 필요한 정렬을 포함한 값이다. 데이터 길이를 인자로 받는다. 상수 식이다.</p>
</li>
</ul>
<p>보조 데이터를 만들려면 먼저 <code>msghdr</code>의 <code>msg_controllen</code> 멤버를 제어 메시지 버퍼의 길이로 설정해야 한다. 그리고 그 <code>msghdr</code>에 <code>CMSG_FIRSTHDR()</code>를 써서 첫 번째 제어 메시지를 얻고 <code>CMSG_NXTHDR()</code>로 이후 메시지들을 얻는다. 각 제어 메시지에서 (<code>CMSG_LEN()</code>으로) <code>cmsg_len</code>을, 다른 <code>cmsghdr</code> 헤더 필드들을, 그리고 <code>CMSG_DATA()</code>를 써서 데이터 부분을 채운다. 마지막으로 <code>msghdr</code>의 <code>msg_controllen</code> 필드를 버퍼 내 모든 제어 메시지 길이의 <code>CMSG_SPACE()</code>의 합으로 설정해야 한다. <code>msghdr</code>에 대한 더 자세한 내용은 <tt><a class="wikilink" href="/man-pages-ko/recvmsg(2)/">recvmsg(2)</a></tt>를 보라.</p>
<h2 id="conforming-to">CONFORMING TO</h2>
<p>이 보조 데이터 모델은 POSIX.1g 초안, 4.4BSD-Lite, RFC 2292에서 기술하는 IPv6 고급 API, SUSv2를 따른다. <code>CMSG_FIRSTHDR()</code>, <code>CMSG_NXTHDR()</code>, <code>CMSG_DATA()</code>는 POSIX-1.2008에 명세돼 있다. <code>CMSG_SPACE()</code>와 <code>CMSG_LEN()</code>은 다음 POSIX 릴리스(Issue 8)에 포함될 예정이다.</p>
<p><code>CMSG_ALIGN()</code>은 리눅스 확장이다.</p>
<h2 id="notes">NOTES</h2>
<p>이식성을 위해선 여기서 설명하는 매크로들만 이용해 보조 데이터에 접근해야 한다. <code>CMSG_ALIGN()</code>은 리눅스 확장이므로 이식성이 있어야 하는 프로그램에서는 사용하지 말아야 한다.</p>
<p>리눅스에서 <code>CMSG_LEN()</code>, <code>CMSG_DATA()</code>, <code>CMSG_ALIGN()</code>은 (인자가 상수라고 하면) 상수 식이고, 따라서 전역 변수 크기를 선언하는 데 그 값을 쓸 수 있다. 하지만 이식성이 없을 수 있다.</p>
<h2 id="examples">EXAMPLES</h2>
<p>다음 코드는 받은 보조 버퍼에서 <code>IP_TTL</code> 옵션을 찾는다.</p>
<pre><code class="language-c">struct msghdr msgh;
struct cmsghdr *cmsg;
int received_ttl;

/* msgh의 보조 데이터 받기 */

for (cmsg = CMSG_FIRSTHDR(&amp;msgh); cmsg != NULL;
        cmsg = CMSG_NXTHDR(&amp;msgh, cmsg)) {
    if (cmsg-&gt;cmsg_level == IPPROTO_IP
            &amp;&amp; cmsg-&gt;cmsg_type == IP_TTL) {
        memcpy(&amp;receive_ttl, CMSG_DATA(cmsg), sizeof(receive_ttl));
        break;
    }
}

if (cmsg == NULL) {
    /* 오류: IP_TTL을 켜지 않았거나 버퍼가 작거나 I/O 오류 */
}
</code></pre>
<p>아래 코드는 <code>SCM_RIGHTS</code>를 이용해 유닉스 도메인 소켓 상으로 파일 디스크립터 배열을 전달한다.</p>
<pre><code class="language-c">struct msghdr msg = { 0 };
struct cmsghdr *cmsg;
int myfds[NUM_FD];  /* 전달할 파일 디스크립터들을 담음 */
char iobuf[1];
struct iovec io = {
    .iov_base = iobuf,
    .iov_len = sizeof(iobuf)
};
union {         /* 보조 데이터 버퍼. 적절히 정렬되게
                   하기 위해 공용체로 감싼다 */
    char buf[CMSG_SPACE(sizeof(myfds))];
    struct cmsghdr align;
} u;

msg.msg_iov = &amp;io;
msg.msg_iovlen = 1;
msg.msg_control = u.buf;
msg.msg_controllen = sizeof(u.buf);
cmsg = CMSG_FIRSTHDR(&amp;msg);
cmsg-&gt;cmsg_level = SOL_SOCKET;
cmsg-&gt;cmsg_type = SCM_RIGHTS;
cmsg-&gt;cmsg_len = CMSG_LEN(sizeof(myfds));
memcpy(CMSG_DATA(cmsg), myfds, sizeof(myfds));
</code></pre>
<h2 id="see-also">SEE ALSO</h2>
<p><tt><a class="wikilink" href="/man-pages-ko/recvmsg(2)/">recvmsg(2)</a></tt>, <tt><a class="wikilink" href="/man-pages-ko/sendmsg(2)/">sendmsg(2)</a></tt></p>
<p>RFC 2292</p>
<hr />
<p>2021-03-22</p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
